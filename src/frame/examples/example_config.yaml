path: /Users/chrysanth/Documents/_code/CoreStudioBruxelles
name: "Core Core Liverpool"

types:
  parsers:
    launchctl:
      type: regex
      pattern: (\d+)\s+(\d+)\s+([\w\.]+)
      list: true
      group:
        pid: 1
        ppid: 2
        name: 3

defaults:
  get:
    shell:
      renderer: string
    screenshot:
      renderer: image

  action:
    notification:
      targets: ["ifttt"]

  target:
    ifttt:
      url: "https://maker.ifttt.com/trigger/corecore_events/json/with/key/oYagjlMI8HcVIo_uqIrm3"

settings:
  osc:
    point: 57120
    endpoint: 127.0.0.1

model:
  project.status:
    name: "Status"
    get:
      type: shell
      cmd: ps aux | grep -v grep | grep sclang
      parser: { type: "detect", pattern: "sclang" }
    renderer: status

  project.processes:
    name: "Processes"
    get:
      type: shell
      cmd: launchctl list
      parser: launchctl
    renderer: json

  project.uptime:
    name: "Uptime"
    poll: 1
    get:
      type: shell
      cmd: "uptime"
      parser: { type: "regex", pattern: "up (.*?),", group: 1 }

  project.cpu:
    name: "CPU Usage"
    poll: 1
    get:
      type: shell
      cmd: 'ps -A -o %cpu | awk ''{s+=$1} END {print s "%"}'''

  project.system_information:
    name: "System Information"
    get:
      type: shell
      cmd:
        [
          "system_profiler",
          "SPHardwareDataType",
          "SPSoftwareDataType",
          "SPStorageDataType",
          "-json",
        ]
      parser: "json"
    renderer: { type: "json", folding: true }

  project.screenshot:
    name: "Screenshot"
    get: screenshot
    renderer: image

actions:
  "restart":
    type: sequence
    actions: ["stop", "start"]
  "stop":
    type: shell
    cmd: ./daemons/disable_autoplay.command
  "start":
    type: shell
    cmd: ./daemons/enable_autoplay.command
  "project_down":
    type: notification
    condition: not({project.status})
    target: ["email"]
    template: "The project is down!"
